<div class="container py-8">
  <div class="flex items-center mb-8">
    <%= link_to @back_path, class: "mr-4 text-gray-500 hover:text-gray-700" do %>
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
    <% end %>
    <h1 class="title">
      <%= title "Events Missing Data" %>
    </h1>
  </div>

  <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-8">
    <div class="flex items-start">
      <%= fa("question-circle", size: :md, class: "fill-blue-600 mt-0.5 mr-4 flex-shrink-0") %>
      <div>
        <h2 class="font-semibold text-blue-800 text-lg mb-2">Help Complete Our Database</h2>
        <p class="text-blue-700 mb-4">
          The events listed below are missing important data such as talk information, schedules,
          or CFP details. If you have knowledge about these events, please consider contributing
          this data to help make RubyEvents.org more complete.
        </p>
        <div class="bg-white border border-blue-200 rounded p-4">
          <h3 class="font-semibold text-blue-800 mb-2">How to contribute event data:</h3>
          <ul class="text-sm text-blue-700 space-y-1">
            <li>â€¢ Research the event website, program, or recorded videos</li>
            <li>â€¢ Look for talk titles, speaker information, and schedules</li>
            <li>â€¢ <a href="https://github.com/rubyevents/rubyevents/blob/main/docs/ADDING_CONFERENCE_ASSETS.md" class="underline hover:text-blue-900" target="_blank">Follow our contribution guide</a> to submit the data</li>
            <li>â€¢ Create a pull request with the event information</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="flex flex-wrap gap-2 mb-6" data-controller="events-filter">
    <button class="badge hover:shadow-md transition-all badge-primary cursor-pointer" data-action="click->events-filter#filterAll" data-events-filter-target="filterBadge" data-filter="all">
      All (<span data-events-filter-target="countAll"><%= @events_missing_data.count %></span>)
    </button>

    <button class="badge hover:shadow-md transition-all badge-outline cursor-pointer" data-action="click->events-filter#filter" data-events-filter-target="filterBadge" data-filter="talks">
      No talks (<span data-events-filter-target="countTalks"><%= @filter_counts[:talks] %></span>)
    </button>

    <button class="badge hover:shadow-md transition-all badge-outline cursor-pointer" data-action="click->events-filter#filter" data-events-filter-target="filterBadge" data-filter="cfp">
      No CFP (<span data-events-filter-target="countCfp"><%= @filter_counts[:cfp] %></span>)
    </button>

    <button class="badge hover:shadow-md transition-all badge-outline cursor-pointer" data-action="click->events-filter#filter" data-events-filter-target="filterBadge" data-filter="website">
      No website (<span data-events-filter-target="countWebsite"><%= @filter_counts[:website] %></span>)
    </button>

    <button class="badge hover:shadow-md transition-all badge-outline cursor-pointer" data-action="click->events-filter#filter" data-events-filter-target="filterBadge" data-filter="schedule">
      No schedule (<span data-events-filter-target="countSchedule"><%= @filter_counts[:schedule] %></span>)
    </button>

    <button class="badge hover:shadow-md transition-all badge-outline cursor-pointer" data-action="click->events-filter#filter" data-events-filter-target="filterBadge" data-filter="sponsors">
      No sponsors (<span data-events-filter-target="countSponsors"><%= @filter_counts[:sponsors] %></span>)
    </button>

    <button class="badge hover:shadow-md transition-all badge-outline cursor-pointer" data-action="click->events-filter#filter" data-events-filter-target="filterBadge" data-filter="dates">
      No dates (<span data-events-filter-target="countDates"><%= @filter_counts[:dates] %></span>)
    </button>

    <button class="badge hover:shadow-md transition-all badge-outline cursor-pointer" data-action="click->events-filter#filter" data-events-filter-target="filterBadge" data-filter="location">
      No location (<span data-events-filter-target="countLocation"><%= @filter_counts[:location] %></span>)
    </button>
  </div>

    <% if @events_by_year.any? %>
    <div class="space-y-8">
      <% @events_by_year.each do |year, events| %>
        <div>
          <h2 class="text-2xl font-bold text-gray-900 mb-4 border-b border-gray-200 pb-2">
            <%= year %>
            <span class="text-base font-normal text-gray-500 ml-2">(<%= pluralize(events.count, "event") %>)</span>
          </h2>

          <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
            <% events.each do |event| %>
              <% missing_data = @events_missing_info[event] || [] %>
              <%= link_to event_path(event), class: "block bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow hover:border-gray-300 event-card",
                  data: {
                    missing: missing_data.join(' '),
                    missing_talks: missing_data.include?(:talks),
                    missing_cfp: missing_data.include?(:cfp),
                    missing_website: missing_data.include?(:website),
                    missing_schedule: missing_data.include?(:schedule),
                    missing_sponsors: missing_data.include?(:sponsors),
                    missing_dates: missing_data.include?(:dates),
                    missing_location: missing_data.include?(:location)
                  } do %>
                <div class="flex items-start justify-between">
                  <div class="flex-1">
                    <h3 class="font-semibold text-gray-900 mb-1 hover:text-brand-600">
                      <%= event.name %>
                    </h3>
                    <p class="text-sm text-gray-600 mb-2"><%= event.organisation.name %></p>
                    <div class="flex items-center text-xs text-gray-500">
                      <%= fa("clock", size: :xs, class: "fill-gray-400 mr-1") %>
                      <%= event.start_date&.strftime("%B %Y") || "Date unknown" %>
                    </div>
                    <% if event.city.present? %>
                      <div class="flex items-center text-xs text-gray-500 mt-1">
                        <svg class="w-3 h-3 mr-1 fill-gray-400" viewBox="0 0 24 24">
                          <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" />
                        </svg>
                        <%= [event.city, event.country_code].compact.join(", ") %>
                      </div>
                    <% end %>

                    <div class="mt-2 flex flex-wrap gap-1">
                      <% if event.talks_count == 0 %>
                        <div class="badge badge-error text-xs text-white">No talks</div>
                      <% end %>
                      <% if event.cfp_link.blank? %>
                        <div class="badge badge-warning text-xs">No CFP</div>
                      <% end %>
                      <% if event.website.blank? %>
                        <div class="badge badge-info text-xs">No website</div>
                      <% end %>
                      <% unless event.schedule.exist? %>
                        <div class="badge badge-secondary text-xs">No schedule</div>
                      <% end %>
                      <% if event.sponsors.empty? %>
                        <div class="badge badge-accent text-xs">No sponsors</div>
                      <% end %>
                      <% if event.start_date.blank? || event.end_date.blank? %>
                        <div class="badge badge-neutral text-xs">No dates</div>
                      <% end %>
                      <% if event.static_metadata.location.blank? || event.static_metadata.location == "Earth" %>
                        <div class="badge badge-ghost text-xs">No location</div>
                      <% end %>
                    </div>
                  </div>
                  <%= fa("question-circle", size: :sm, class: "fill-red-500 ml-2 flex-shrink-0") %>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <div class="mt-12 text-center">
      <p class="text-gray-600 mb-4">
        <span data-events-filter-target="statusText">Total events missing data: <strong><%= @events_missing_data.count %></strong></span>
      </p>
      <p class="text-sm text-gray-500">
        Last updated: <%= Date.current.strftime("%B %d, %Y") %>
      </p>
    </div>
  <% else %>
    <div class="text-center py-12">
      <div class="text-6xl mb-4">ðŸŽ‰</div>
      <h2 class="text-2xl font-bold text-gray-900 mb-4">All Events Have Complete Data!</h2>
      <p class="text-gray-600">
        Great news! All events in our database have complete information.
      </p>
    </div>
  <% end %>
</div>
